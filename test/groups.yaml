# ------------------------------------------------------------------------------
# Testing Groups
#
# Addons need to be added to a testing group here to be validated and deploy &
# cleanup tested. New addons need to be added to a group or CI will fail.
#
# NOTE: only the most recent revision of an addon will be tested. If you need
# to run specific tests for older revisions, you'll need to write explicit tests
# to cover that scenario.
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# General
#
# Addons in this testing group are simple, low on resource requirements and dont
# require any dependencies or significant work to deploy.
# ------------------------------------------------------------------------------
general:
  kubernetesVersion: 1.15.6
  clusterInterface: kind
  addons:
    - "cert-manager"
    - "dashboard"
    - "dex"
    - "external-dns"
    - "gatekeeper"
    - "konvoyconfig"
    - "metallb"
    - "opsportal"
    - "reloader"
    - "traefik"

# ------------------------------------------------------------------------------
# ElasticSearch
#
# All ElasticSearch related addons should be tested as a part of this group
# ------------------------------------------------------------------------------
elasticsearch:
  kubernetesVersion: 1.15.6
  clusterInterface: kind
  addons:
    - "elasticsearch"
    - "elasticsearchexporter"
    - "fluentbit"
    - "kibana"

# ------------------------------------------------------------------------------
# Prometheus
#
# All Prometheus related addons should be tested as a part of this group
# ------------------------------------------------------------------------------
prometheus:
  kubernetesVersion: 1.15.6
  clusterInterface: kind
  addons:
    - "dispatch"
    - "opsportal"
    - "prometheus"
    - "prometheusadapter"

# ------------------------------------------------------------------------------
# Kommander
#
# All Kommander related addons should be tested as a part of this group
# ------------------------------------------------------------------------------
kommander:
  kubernetesVersion: 1.15.6
  clusterInterface: kind
  addons:
    - "metallb"
    - "opsportal"
    - "cert-manager"
    - "traefik"
    - "dex"
    - "konvoyconfig"
    - "reloader"
    - "kommander"

# ------------------------------------------------------------------------------
# Istio
#
# All Istio related addons should be tested as a part of this group
# ------------------------------------------------------------------------------
istio:
  kubernetesVersion: 1.15.6
  clusterInterface: kind
  addons:
    - "prometheus"
    - "metallb"
    - "opsportal"
    - "cert-manager"
    - "istio"
    - "flagger"


# ------------------------------------------------------------------------------
# KonvoyGeneral
#
# Testing simple addons using konvoy
# ------------------------------------------------------------------------------
konvoyGeneral:
  clusterInterface: konvoy
  konvoyProvisioner: docker
  addons:
    - "dashboard"

# ------------------------------------------------------------------------------
# KonvoySecurity
#
# Tests that all security addons can be deployed
# ------------------------------------------------------------------------------
konvoySecurity:
  clusterInterface: konvoy
  konvoyProvisioner: docker
  addons:
    - "cert-manager"
    - "dex"
    - "dex-k8s-authenticator"
    - "kube-oidc-proxy"
    - "metallb"
    - "traefik"
    - "traefik-forward-auth"

# ------------------------------------------------------------------------------
# KonvoyCertManager
#
# Testing default cert-manager deployment on konvoy
# ------------------------------------------------------------------------------
konvoyCertManager:
  clusterInterface: konvoy
  konvoyProvisioner: docker
  addons:
    - "cert-manager"

# ------------------------------------------------------------------------------
# Disabled
#
# These are Addons which tests are currently disabled for.
# ------------------------------------------------------------------------------
disabled:
  addons:
    # kudo gets tested in https://github.com/mesosphere/kubeaddons-enterprise, and is likely going to be removed from this repository.
    # See: https://jira.mesosphere.com/browse/DCOS-61842
    - "kudo"

    # these are addons which are currently filtered out of tests because we're waiting on features to be able to test them properly.
    # See: https://jira.mesosphere.com/browse/DCOS-61664
    - "dex-k8s-authenticator"
    - "awsebscsiprovisioner"
    - "awsebsprovisioner"
    - "azuredisk-csi-driver"
    - "azurediskprovisioner"
    - "metallb"
    - "nvidia"

    # the following addons need tests added
    # See: https://jira.mesosphere.com/browse/DCOS-61664
    - "traefik-forward-auth"
    - "dex-k8s-authenticator"
    - "kube-oidc-proxy"
    - "velero"
    - "localvolumeprovisioner"
    - "defaultstorageclass-protection"

    # konvoyConfig is being deprecated by kep: 20191204-templating
    - "konvoyconfig"
